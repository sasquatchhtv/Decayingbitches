--// Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local Lighting = game:GetService("Lighting")
local Players = game:GetService("Players")

--// Variables
local localPlayer = Players.LocalPlayer
local mainHandler = { instance = nil, senv = nil }
local namecall = nil
local toggle = {
    using = false,
    blocking = { false, 0, 0 },
    dashing = { false },
    healing = { false },
    grappling = { false }
}

local activeStat = {
    def = { func = nil, upvalue = 0 },
    mvt = { func = nil, upvalue = 0 },
}

local humanoid = game.Players.LocalPlayer.Character.Humanoid
local currentHealth = humanoid.Health
humanoid.HealthChanged:Connect(function(health)
    local change = math.abs(currentHealth - health)
    workspace.ServerStuff.applyGore:FireServer("gunricochet", localPlayer.Character, localPlayer, { localPlayer.Character["Left Arm"]:GetPivot().Position })
    currentHealth = health
end)

local args = {
    [1] = "aegisprotect"
}

workspace.ServerStuff.handlePerkVisibility:FireServer(unpack(args))

--// Functions
function spawnItem(itemName, slot)
    local inventory = getupvalue(mainHandler.senv.start_dual_wield, 3)
    local function spawn(use)
        if inventory[slot][1] ~= itemName then
            if workspace.InteractablesNoDel:FindFirstChild("Personal Workbench") ~= nil then
                repeat
                    ReplicatedStorage.Interactables.interaction:FireServer(workspace.InteractablesNoDel["Personal Workbench"], "buybaseupgrade", _G.serverKey)
                    RunService.Heartbeat:Wait()
                until workspace.InteractablesNoDel:FindFirstChild("Workbench") ~= nil
            end

            local workbench = workspace.InteractablesNoDel:FindFirstChild("Workbench") or workspace.Interactables:FindFirstChild("Workbench")
            if workbench:FindFirstChild("stats") == nil then
                return
            end

            ReplicatedStorage.Interactables.interaction:FireServer(workbench, "workbenchblueprint" .. itemName, _G.playerKey)
            repeat RunService.Heartbeat:Wait() until workbench.stats.blueprint.Value == itemName

            ReplicatedStorage.Interactables.interaction:FireServer(workbench, "workbench", _G.playerKey)

            local self = nil
            self = workspace.WeaponDrops.ChildAdded:Connect(function(item)
                if item.Name == itemName and (item:GetPivot().Position - workbench:GetPivot().Position).Magnitude <= 20 then
                    if inventory[slot][1] ~= "Fist" then
                        inventory[slot] = {"Fist", false, nil}
                    end

                    local lastPosition = localPlayer.Character:GetPivot()
                    repeat
                        localPlayer.Character:PivotTo(item:GetPivot() + Vector3.new(0, 5, 0))
                        workspace.ServerStuff.claimItem:InvokeServer(item)

                        RunService.Heartbeat:Wait()
                    until localPlayer.Character.valids:FindFirstChild(itemName) ~= nil

                    local animSet = nil
                    for _, v in pairs(ReplicatedStorage.animationSets.TPanimSets:GetChildren()) do
                        if v.Name == require(workspace.ServerStuff.Statistics.W_STATISTICS)[itemName].animset then
                            animSet = v
                        end
                    end

                    repeat
                        if use == nil then
                            workspace.ServerStuff.getTPWeapon:FireServer(itemName, animSet, "Fist", item, true)
                        else
                            workspace.ServerStuff.getTPWeapon:FireServer(itemName, animSet, "Fist", item, false)
                        end

                        RunService.Heartbeat:Wait()
                    until workspace.WeaponDrops:FindFirstChild(item) == nil

                    localPlayer.Character:PivotTo(lastPosition)
                    inventory[slot] = {itemName, false, nil}

                    self:Disconnect(); self = nil
                end
            end)
        end
    end

UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent == true then
        return
    end
        if input.KeyCode == Enum.KeyCode.G then

           
            local direction = char.PrimaryPart.CFrame.Position + Vector3.new(0, .5, 0)
            local bodyPosition = Instance.new("BodyPosition")
            bodyPosition.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            bodyPosition.P = 27500

            if UserInputService:IsKeyDown(Enum.KeyCode.W) == true then direction -= char.PrimaryPart.CFrame.ZVector * 18 end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) == true then direction -= char.PrimaryPart.CFrame.XVector * 18 end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) == true then direction += char.PrimaryPart.CFrame.ZVector * 18 end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) == true then direction += char.PrimaryPart.CFrame.XVector * 18 end

            if UserInputService:IsKeyDown(Enum.KeyCode.W) == false and UserInputService:IsKeyDown(Enum.KeyCode.A) == false and UserInputService:IsKeyDown(Enum.KeyCode.S) == false and UserInputService:IsKeyDown(Enum.KeyCode.D) == false then direction += char.PrimaryPart.CFrame.ZVector * 18 end

            workspace.ServerStuff.playAudio:FireServer({"soldiers"}, "dash", char.PrimaryPart)
            bodyPosition.Position = direction
            bodyPosition.Parent = char.PrimaryPart
char.Humanoid:LoadAnimation(animfolder.special.dash):Play()

            task.wait(.2)
            bodyPosition:Destroy()
        end
       
        if input.KeyCode == Enum.KeyCode.V then
            if posing == false then 
                posing = true
                restanim:Play()
char.HumanoidRootPart.Anchored = true
            else
                posing = false
                restanim:Stop()
char.HumanoidRootPart.Anchored = false
end
        end
  
end)

    for index, value in pairs(require(workspace.ServerStuff.Statistics.W_STATISTICS)) do
        if string.match(string.lower(index), string.lower(itemName)) ~= nil then
            itemName = index

            local use = nil
            if value.weapontype == "Item" or value.weapontype == "Bow" or value.weapontype == "Gun" then
                if ReplicatedStorage.Weapons:FindFirstChild(index) then
                    use = ReplicatedStorage.Weapons[index].ammo.Value
                end

                if slot == nil then
                    for inventorySlot, content in pairs(inventory) do
                        if inventorySlot ~= 1 and content[1] == "Fist" then
                            slot = inventorySlot
                            break
                        end
                    end
                end
            end

            if localPlayer.Character.valids:FindFirstChild(itemName) ~= nil then
                inventory[slot] = {itemName, false, use}
            else
                spawn(use)
            end

            repeat RunService.Heartbeat:Wait() until inventory[slot][1] == itemName and localPlayer.PlayerGui.mainHUD:FindFirstChild("InventoryFrame") ~= nil
            mainHandler.senv.invmanage("updatehud")

            break
        end
    end
end

function damage(character, damage)
    if character:FindFirstChildOfClass("Humanoid").Health <= 0 then
        return
    end

    local changeToRevolver = coroutine.create(function()
        local originalPerk = localPlayer.Character:FindFirstChild("current_perk").Value
        if originalPerk ~= nil and originalPerk ~= "revolver" then
            workspace.ServerStuff.changeStats:InvokeServer("changeclass", "revolver")
            coroutine.yield()
            workspace.ServerStuff.changeStats:InvokeServer("changeclass", originalPerk)
        end
    end)
    coroutine.resume(changeToRevolver)

    local activestat = require(workspace.ServerStuff.Statistics.CLASS_STATISTICS).revolver.activestats
    activestat._revolver_damage = activestat.revolver_damage
    activestat._revolver_headshot_multi = activestat.revolver_headshot_multi
    activestat.revolver_damage = damage
    activestat.revolver_headshot_multi = 0

    workspace.ServerStuff.dealDamage:FireServer("revolver_shot", { character, damage }, _G.serverKey, _G.playerKey)
    coroutine.resume(changeToRevolver)

    activestat.revolver_damage = activestat._revolver_damage
    activestat.revolver_headshot_multi = activestat._revolver_headshot_multi
    activestat._revolver_damage = nil
    activestat._revolver_headshot_multi = nil
end

function getActiveStat()
    if mainHandler.senv.maingui:FindFirstChild("devbox") == nil then
        local devbox = Instance.new("Frame")
        devbox.Size = UDim2.new(0, 0)
        devbox.BackgroundTransparency = 0
        devbox.BorderSizePixel = 0
        devbox.Parent = mainHandler.senv.maingui
        devbox.Name = "devbox"

        local devlabel1 = Instance.new("TextLabel")
        devlabel1.Size = UDim2.new(0, 0)
        devlabel1.BackgroundTransparency = 0
        devlabel1.BorderSizePixel = 0
        devlabel1.TextSize = 0
        devlabel1.Parent = devbox
        devlabel1.Name = "devlabel1"

        local devlabel2 = Instance.new("TextLabel")
        devlabel2.Size = UDim2.new(0, 0)
        devlabel2.BackgroundTransparency = 0
        devlabel2.BorderSizePixel = 0
        devlabel2.TextSize = 0
        devlabel2.Parent = devbox
        devlabel2.Name = "devlabel2"

        local devlabel3 = Instance.new("TextLabel")
        devlabel3.Size = UDim2.new(0, 0)
        devlabel3.BackgroundTransparency = 0
        devlabel3.BorderSizePixel = 0
        devlabel3.TextSize = 0
        devlabel3.Parent = devbox
        devlabel3.Name = "devlabel3"

        while devlabel1.Text == "" or devlabel2.Text == "" or devlabel3.Text == "" do
            RunService.Heartbeat:Wait()
        end
    end

    local found = false
    while found == false do
        for _, functions in pairs(getreg()) do
            if type(functions) == "function" and getfenv(functions).script and getfenv(functions).script == mainHandler.instance then
                local upvalues = getupvalues(functions)

                for i, v in pairs(upvalues) do
                    if type(v) == "number" then
                        if tostring(v) == string.sub(mainHandler.senv.maingui.devbox.devlabel1.Text, 7, -1) or tostring(v) == string.sub(mainHandler.senv.maingui.devbox.devlabel2.Text, 7, -1) or tostring(v) == string.sub(mainHandler.senv.maingui.devbox.devlabel3.Text, 14, -1) then
                            local random = math.random(-20, -10)
                            local old = v

                            setupvalue(functions, i, random)
                            RunService.Heartbeat:Wait()

                            if string.sub(mainHandler.senv.maingui.devbox.devlabel2.Text, 7, -1) == tostring(random) then
                                activeStat.def = {
                                    func = functions,
                                    upvalue = i,
                                }

                                found = true
                            end

                            if string.sub(mainHandler.senv.maingui.devbox.devlabel3.Text, 14, -1) == tostring(random) then
                                activeStat.mvt = {
                                    func = functions,
                                    upvalue = i,
                                }

                                found = true
                            end

                            setupvalue(functions, i, old)
                        end
                    end
                end
            end
        end

        RunService.Heartbeat:Wait()
    end
end

local function start()
    for _, instance in ipairs(localPlayer.Backpack:GetChildren()) do
        if instance:IsA("LocalScript") and instance.Name ~= "ClickDetectorScript" then
            repeat
                mainHandler.instance = instance
                mainHandler.senv = getsenv(mainHandler.instance)
                RunService.Heartbeat:Wait()
            until mainHandler.senv.afflictstatus ~= nil and mainHandler.senv.unloadgun ~= nil and mainHandler.senv.ration_system_handler ~= nil

            for index, upvalue in ipairs(getupvalues(mainHandler.senv.afflictstatus)) do
                if typeof(upvalue) == "number" then
                    for _, key in pairs(getrenv()._G) do
                        if upvalue == key then
                            _G.serverKey = upvalue
                        end
                    end
                end

                if upvalue == _G.serverKey then
                    _G.playerKey = getupvalue(mainHandler.senv.afflictstatus, index + 1)
                    break
                end
            end
        end
    end

    spawnItem("FAxe", 1)
    getActiveStat()

    mainHandler.senv.teamfolder = nil

    workspace.ServerStuff.dropAmmo:FireServer("scrap", 90)
    _G.connection[5] = workspace.Interactables.ChildAdded:Connect(function(instance)
        if instance.Name == "Salvage Pack" then
            repeat RunService.Heartbeat:Wait() until instance:FindFirstChild("stats") ~= nil
            if instance.stats.scrap.Value == 90 then
                ReplicatedStorage.Interactables.interaction:FireServer(instance, "getScrap", _G.serverKey)
                _G.connection[5]:Disconnect()
            end
        end
    end)

    setupvalue(activeStat.mvt.func, activeStat.mvt.upvalue, 14)

    local ammo = getupvalues(mainHandler.senv.unloadgun)[7]
    ammo.Small = 200
    ammo.Shells = 200
    ammo.Long = 200
    ammo.Short = 200
    ammo.Heavy = 200
    ammo.Medium = 200
    ammo.Light = 200

    local ration = mainHandler.senv.ration_system_handler
    ration.Soda = 25
    ration.Bottle = 25
    ration.Beans = 50
    ration.MRE = 50


    _G.connection[3] = RunService.RenderStepped:Connect(function()
        if workspace.GamemodeStuff:FindFirstChild("outerGas") ~= nil then
            workspace.GamemodeStuff.outerGas:Destroy()
        end
    end)

    localPlayer.Character.Humanoid.Died:Connect(function()
        workspace.ServerStuff.playAudio:FireServer({"general"}, "donk", localPlayer.Character.PrimaryPart)
    end)
end

--// Set up
if _G.connection ~= nil then
    for _, connection in ipairs(_G.connection) do
        connection:Disconnect()
    end
end
_G.connection = {}

start()

--// Keybinds
_G.connection[1] = UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent == true then
        return
    end

    if localPlayer.Character ~= nil then
        if input.KeyCode == Enum.KeyCode.Q then
        local playerAnimation = game.Players.LocalPlayer.Character.Humanoid.Animator:LoadAnimation(game.ReplicatedStorage.animationSets.TPanimSets["RRIOT"].grapple)
        playerAnimation.Priority = Enum.AnimationPriority.Action
        playerAnimation:Play()
        playerAnimation:AdjustSpeed(3)
        end

        if input.KeyCode == Enum.KeyCode.R then
                if toggle.using == true then
                    return
                end

                toggle.blocking[1] = true

                getupvalue(mainHandler.senv.drop_slide, 1).action = true
                getupvalue(mainHandler.senv.drop_slide, 1).blocking = true
                getupvalue(mainHandler.senv.drop_slide, 1).cancombo = false

                local args = {
                    [1] = "enable_aegis_shield"
                }

                workspace.ServerStuff.handlePerkVisibility:FireServer(unpack(args))

                local playerAnimation = game.Players.LocalPlayer.Character.Humanoid.Animator:LoadAnimation(game.ReplicatedStorage.animationSets.TPanimSets["global"].perk_shield_shove)
                playerAnimation.Priority = Enum.AnimationPriority.Action
                playerAnimation:Play()

                workspace.ServerStuff.playAudio:FireServer({ "perks" }, "aegisbreak", localPlayer.Character.PrimaryPart)
                workspace.ServerStuff.initiateblock:FireServer(_G.serverKey, true)

                toggle.blocking[4] = localPlayer.Character.Humanoid.Animator:LoadAnimation(game.ReplicatedStorage.animationSets.TPanimSets["global"].perk_shield_shove)
                toggle.blocking[4].Priority = Enum.AnimationPriority.Action
                toggle.blocking[4]:Play(.1)
                toggle.blocking[4].TimePosition = .3
                toggle.blocking[4]:AdjustSpeed(0)

                toggle.blocking[5] = workspace.CurrentCamera.FPArms.AC.Animator:LoadAnimation(ReplicatedStorage.animationSets["1HS"].block)
                toggle.blocking[5].Priority = Enum.AnimationPriority.Action
                toggle.blocking[5]:Play(.15)
                toggle.blocking[5]:AdjustSpeed(0)

                toggle.blocking[2] = localPlayer.Character.Humanoid.Health
                toggle.blocking[3] = getupvalue(activeStat.def.func, activeStat.def.upvalue)

                toggle.blocking[6] = localPlayer.Character.Humanoid.HealthChanged:Connect(function(health)
                    if health < toggle.blocking[2] then
                        if toggle.blocking[2] - health >= 10 then
                            local integral = math.modf((toggle.blocking[2] - localPlayer.Character.Humanoid.Health) / 8)
                            for _ = 1, integral do
                                workspace.ServerStuff.dealDamage:FireServer("lazarusheal", 8, _G.serverKey, _G.playerKey)
                            end

                            if toggle.blocking[2] - (integral * 8) > 0 then
                                workspace.ServerStuff.dealDamage:FireServer("lazarusheal", (toggle.blocking[2] - localPlayer.Character.Humanoid.Health) - (integral * 8), _G.serverKey, _G.playerKey)
                            end
                        end
                        workspace.ServerStuff.applyGore:FireServer("gunricochet", localPlayer.Character, localPlayer, { localPlayer.Character.hasPrimary.FAxe:GetPivot().Position })
                    end
                end)
            end

        if input.KeyCode == Enum.KeyCode.V then
            if localPlayer.Character.Humanoid.Health <= 101 then
                if toggle.healing[1] == true or toggle.using == true then
                    return
                end
                -- credit to havenviex for the tickspider backup :>
local mainHandler = nil
for _, instance in pairs(localPlayer.Backpack:GetChildren()) do
    if instance:IsA("LocalScript") and instance.Name ~= "ClickDetectorScript" then
        repeat
            mainHandler = getsenv(instance)
            game:GetService("RunService").Heartbeat:Wait()
        until mainHandler.afflictstatus ~= nil

        local upvalue = getupvalues(mainHandler.afflictstatus)
        _G.serverKey = upvalue[16]
        _G.playerKey = upvalue[17]
    end
end
local lp = game.Players.LocalPlayer
local gm = lp:GetMouse()
local ROOT = lp.Character.HumanoidRootPart
gm.TargetFilter = workspace.Camera
                
                toggle.healing[1] = true
                toggle.using = true

               ROOT.Anchored = true

  local args = {
    [1] = {
        [1] = "ai",
        [2] = "boss",
    },
    [2] = game.ReplicatedStorage.soundLibrary.ai.boss:GetChildren()[math.random(1,#game.ReplicatedStorage.soundLibrary.ai.boss:GetChildren())].Name,
    [3] = game.workspace
}

workspace.ServerStuff.playAudio:FireServer(unpack(args))

               local playerAnimation = game.Players.LocalPlayer.Character.Humanoid.Animator:LoadAnimation(game.ReplicatedStorage.animationSets.TPanimSets["global"].shield)
               playerAnimation.Priority = Enum.AnimationPriority.Action
               playerAnimation:Play()
               task.wait(3)
               playerAnimation:AdjustSpeed(0)
               
local rnglol = math.random(1,2)
if (rnglol == 1) then
    workspace.ServerStuff.changeStats:InvokeServer("changeclass", "trapper")
    local args = {
    [1] = "throwticks",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x + 10, ROOT.CFrame.y, ROOT.CFrame.z), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
    [3] = _G.serverKey,
    [4] = _G.playerKey

}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "throwticks",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x, ROOT.CFrame.y, ROOT.CFrame.z + 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
     [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "throwticks",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x - 10, ROOT.CFrame.y, ROOT.CFrame.z), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
      [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "throwticks",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x, ROOT.CFrame.y, ROOT.CFrame.z - 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
   [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "throwticks",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x + 10, ROOT.CFrame.y, ROOT.CFrame.z - 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
     [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "throwticks",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x - 10, ROOT.CFrame.y, ROOT.CFrame.z + 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
      [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "throwticks",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x + 10, ROOT.CFrame.y, ROOT.CFrame.z + 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
      [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "throwticks",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x - 10, ROOT.CFrame.y, ROOT.CFrame.z - 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
     [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
task.wait(7)
playerAnimation:Stop()
ROOT.Anchored = false

elseif (rnglol == 2) then
    workspace.ServerStuff.changeStats:InvokeServer("changeclass", "mind")
    local args = {
    [1] = "dropmkiller",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x + 10, ROOT.CFrame.y, ROOT.CFrame.z), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
    [3] = _G.serverKey,
    [4] = _G.playerKey

}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "dropmkiller",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x, ROOT.CFrame.y, ROOT.CFrame.z + 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
     [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "dropmkiller",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x - 10, ROOT.CFrame.y, ROOT.CFrame.z), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
      [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "dropmkiller",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x, ROOT.CFrame.y, ROOT.CFrame.z - 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
   [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "dropmkiller",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x + 10, ROOT.CFrame.y, ROOT.CFrame.z - 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
     [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "dropmkiller",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x - 10, ROOT.CFrame.y, ROOT.CFrame.z + 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
      [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "dropmkiller",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x + 10, ROOT.CFrame.y, ROOT.CFrame.z + 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
      [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
local args = {
    [1] = "dropmkiller",
    [2] = {
        [1] = CFrame.new(Vector3.new(ROOT.CFrame.x - 10, ROOT.CFrame.y, ROOT.CFrame.z - 10), Vector3.new(ROOT.CFrame.Position)),
        [2] = true
    },
     [3] = _G.serverKey,
    [4] = _G.playerKey
}
workspace.ServerStuff.dealDamage:FireServer(unpack(args))
task.wait(7)
playerAnimation:Stop()
ROOT.Anchored = false
        
                _G.connection[3]:Disconnect()

                toggle.using = false

                task.wait(45)
                toggle.healing[1] = false
            end
        end

        if input.KeyCode == Enum.KeyCode.LeftAlt then
            if toggle.dashing[1] == true or toggle.using == true then
                return
            end
            toggle.dashing[1] = true
            toggle.using = true

            local animation = localPlayer.Character.Humanoid.Animator:LoadAnimation(ReplicatedStorage.animationSets.TPanimSets.special.dash)
            local direction = localPlayer.Character.PrimaryPart.CFrame.Position + Vector3.new(0, .5, 0)
            local bodyPosition = Instance.new("BodyPosition")
            bodyPosition.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            bodyPosition.P = 27500

            if UserInputService:IsKeyDown(Enum.KeyCode.W) == true then direction -= localPlayer.Character.PrimaryPart.CFrame.ZVector * 18 end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) == true then direction -= localPlayer.Character.PrimaryPart.CFrame.XVector * 18 end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) == true then direction += localPlayer.Character.PrimaryPart.CFrame.ZVector * 18 end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) == true then direction += localPlayer.Character.PrimaryPart.CFrame.XVector * 18 end

            if UserInputService:IsKeyDown(Enum.KeyCode.W) == false and UserInputService:IsKeyDown(Enum.KeyCode.A) == false and UserInputService:IsKeyDown(Enum.KeyCode.S) == false and UserInputService:IsKeyDown(Enum.KeyCode.D) == false then direction += localPlayer.Character.PrimaryPart.CFrame.ZVector * 18 end

            workspace.ServerStuff.playAudio:FireServer({"soldiers"}, "dash", localPlayer.Character.PrimaryPart)
            bodyPosition.Position = direction
            bodyPosition.Parent = localPlayer.Character.PrimaryPart
            animation:Play()

            task.wait(.2)
            bodyPosition:Destroy()
            toggle.using = false

            task.wait(.8)
            toggle.dashing[1] = false
        end
        end
    end
end)

_G.connection[2] = UserInputService.InputEnded:Connect(function(input, _)
    if input.KeyCode == Enum.KeyCode.R then
        if toggle.blocking[1] == true and toggle.blocking[4] ~= nil and toggle.blocking[5] ~= nil then
            toggle.blocking[1] = false

            getupvalue(mainHandler.senv.drop_slide, 1).action = false
            getupvalue(mainHandler.senv.drop_slide, 1).blocking = false
            getupvalue(mainHandler.senv.drop_slide, 1).cancombo = true

            workspace.ServerStuff.initiateblock:FireServer(_G.serverKey, false)

            toggle.blocking[4]:Stop(.1)
            toggle.blocking[5]:Stop(.15)

            toggle.blocking[6]:Disconnect()
            toggle.blocking[6] = nil

            local args = {
              [1] = "hide_perk"
            }

            workspace.ServerStuff.handlePerkVisibility:FireServer(unpack(args))


            local args = {
              [1] = "aegisprotect"
            }

            workspace.ServerStuff.handlePerkVisibility:FireServer(unpack(args))

            local playerAnimation = game.Players.LocalPlayer.Character.Humanoid.Animator:LoadAnimation(game.ReplicatedStorage.animationSets.TPanimSets["global"].perk_shield_shove)
            playerAnimation.Priority = Enum.AnimationPriority.Action
            playerAnimation:Play()

            workspace.ServerStuff.playAudio:FireServer({ "world_item" }, "turret_power_down", localPlayer.Character.PrimaryPart)

            setupvalue(activeStat.def.func, activeStat.def.upvalue, toggle.blocking[3])

            if localPlayer.Character.Humanoid.Health < toggle.blocking[2] then
                local integral = math.modf((toggle.blocking[2] - localPlayer.Character.Humanoid.Health) / 8)
                for _ = 1, integral do
                    workspace.ServerStuff.dealDamage:FireServer("lazarusheal", 8, _G.serverKey, _G.playerKey)
                end

                if toggle.blocking[2] - (integral * 8) > 0 then
                    workspace.ServerStuff.dealDamage:FireServer("lazarusheal", (toggle.blocking[2] - localPlayer.Character.Humanoid.Health) - (integral * 8), _G.serverKey, _G.playerKey)
                end
            end
        end
    end
end)

local localPlayer2 = game:GetService("Players").LocalPlayer
local distance = 4

workspace.NoTarget.ChildAdded:Connect(function(instance)
    if instance.Name == "bloodfxtrail" then
        if (instance.CFrame.Position - localPlayer2.Character:GetPivot().Position).Magnitude <= distance then
            workspace.ServerStuff.applyGore:FireServer("gunricochet", game.Players.LocalPlayer.Character["Left Arm"], localPlayer2, { instance.Position })
        end
    end
end)

--// Animation
local TPanimSets = ReplicatedStorage.animationSets.TPanimSets
TPanimSets.global.low_walk.AnimationId = TPanimSets.global.run.AnimationId
TPanimSets.global.low_idle.AnimationId = TPanimSets.global.idle.AnimationId
TPanimSets["2H"].equip.AnimationId = TPanimSets.RRIOT.equip.AnimationId
TPanimSets["2H"].swing.AnimationId = TPanimSets.RRIOT.swing.AnimationId
TPanimSets["2H"].swing2.AnimationId = TPanimSets.RRIOT.swing2.AnimationId
TPanimSets["2H"].charge.AnimationId = TPanimSets.RRIOT.charge.AnimationId
TPanimSets.global.shove.AnimationId = TPanimSets.RRIOT.grapple.AnimationId
setupvalue(activeStat.def.func, activeStat.def.upvalue, math.huge)

--// Hooking
namecall = hookfunction(getrawmetatable(game).__namecall, newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    if method == "FireServer" then
        if self.Name == "dealDamage" then
            if typeof(args[1]) == "table" then
                if args[1][2] ~= nil and args[1][2].Parent == workspace.activePlayers and args[1][3] ~= "shove" then
                    coroutine.wrap(damage)(args[1][2], args[1][3])
                end
            end
        end

        if self.Name == "playAudio" then
            if args[1][1] == "movement_sounds" then
                return true
            end
        end

        if self.Name == "initiateblock" then
            if toggle.blocking[1] == true and args[2] == false then
                return true
            end
        end

        if self.Name == "BREATHE" then
            return true
        end
    end
    
    if method == "Kick" then
        return true
    end

    return namecall(self, ...)
end))
